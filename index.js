let words = ["comme", "je", "son", "que", "Ã©tait", "pour", "sur", "sont", "avec", "ils", "Ãªtre", "un", "avoir", "ce", "par", "chaud", "mot", "mais", "que", "certains", "est", "il", "vous", "ou", "eu", "la", "de", "Ã ", "et", "un", "dans", "nous", "boÃ®te", "dehors", "autre", "Ã©taient", "qui", "faire", "leur", "temps", "si", "volontÃ©", "comment", "dit", "un", "chaque", "dire", "ne", "ensemble", "trois", "vouloir", "air", "bien", "aussi", "jouer", "petit", "fin", "mettre", "maison", "lire", "main", "port", "grand", "Ã©peler", "ajouter", "mÃªme", "terre", "ici", "grand", "haut", "tel", "suivre", "acte", "pourquoi", "interroger", "hommes", "changement", "lumiÃ¨re", "genre", "de", "besoin", "maison", "image", "essayer", "nous", "encore", "animal", "point", "mÃ¨re", "monde", "prÃ¨s", "construire", "soi", "terre", "pÃ¨re", "tout", "nouveau", "travail", "partie", "prendre", "obtenir", "lieu", "fabriquÃ©", "vivre", "oÃ¹", "aprÃ¨s", "arriÃ¨re", "peu", "seulement", "tour", "homme", "annÃ©e", "venu", "montrer", "tous", "bon", "moi", "donner", "notre", "sous", "nom", "trÃ¨s", "par", "juste", "forme", "phrase", "grand", "penser", "dire", "aider", "faible", "ligne", "diffÃ©rer", "tour", "cause", "beaucoup", "signifier", "avant", "dÃ©mÃ©nagement", "droit", "garÃ§on", "vieux", "trop", "mÃªme", "elle", "tous", "lÃ ", "quand", "jusqu'Ã ", "utiliser", "votre", "maniÃ¨re", "sur", "beaucoup", "puis", "les", "Ã©crire", "voudrais", "comme", "si", "ces", "son", "long", "faire", "chose", "voir", "lui", "deux", "a", "regarder", "plus", "jour", "pourrait", "aller", "venir", "fait", "nombre", "son", "aucun", "plus", "personnes", "ma", "sur", "savoir", "eau", "que", "appel", "premiÃ¨re", "qui", "peut", "vers", "cÃ´tÃ©", "Ã©tÃ©", "maintenant", "trouver", "tÃªte", "supporter", "propre", "page", "devrait", "pays", "trouvÃ©", "rÃ©ponse", "Ã©cole", "croÃ®tre", "Ã©tude", "encore", "apprendre", "usine", "couvercle", "nourriture", "soleil", "quatre", "entre", "Ã©tat", "garder", "il", "jamais", "dernier", "laisser", "pensÃ©e", "ville", "arbre", "traverser", "ferme", "dur", "dÃ©but", "puissance", "histoire", "scie", "loin", "mer", "tirer", "gauche", "tard", "courir", "tandis", "presse", "proche", "nuit", "rÃ©el", "vie", "peu", "nord", "livre", "porter", "science", "manger", "chambre", "ami", "idÃ©e", "poisson", "montagne", "fois", "base", "entendre", "cheval", "coupe", "sÃ»r", "regarder", "couleur", "face", "bois", "principal", "ouvert", "paraÃ®tre", "ensemble", "suivant", "blanc", "enfants", "commencer", "eu", "marcher", "exemple", "facilitÃ©", "papier", "groupe", "toujours", "musique", "ceux", "marque", "souvent", "lettre", "mile", "riviÃ¨re", "voiture", "pieds", "soins", "deuxiÃ¨me", "assez", "plaine", "fille", "habituel", "jeune", "prÃªt", "au-dessus", "jamais", "rouge", "liste", "bien", "sentir", "parler", "oiseau", "bientÃ´t", "corps", "chien", "famille", "direct", "pose", "laisser", "chanson", "mesurer", "porte", "produit", "noir", "court", "chiffre", "classe", "vent", "question", "arriver", "complÃ¨te", "navire", "zone", "moitiÃ©", "rock", "ordre", "feu", "sud", "problÃ¨me", "piÃ¨ce", "dit", "savait", "passer", "depuis", "haut", "ensemble", "roi", "rue", "pouce", "multiplier", "rien", "cours", "rester", "roue", "plein", "force", "bleu", "objet", "dÃ©cider", "surface", "profond", "lune", "Ã®le", "pied", "systÃ¨me", "occupÃ©", "test", "record", "bateau", "commun", "or", "possible", "plan", "place", "sec", "se", "rire", "mille", "il", "ran", "vÃ©rifier", "jeu", "forme", "assimiler", "chaud", "manquer", "apportÃ©", "chaleur", "neige", "pneu", "apporter", "oui", "lointain", "remplir", "est", "peindre", "langue", "entre", "unitÃ©", "puissance", "ville", "fin", "certain", "voler", "tomber", "conduire", "cri", "sombre", "machine", "note", "patienter", "plan", "figure", "Ã©toile", "boÃ®te", "nom", "domaine", "reste", "correct", "capable", "livre", "terminÃ©", "beautÃ©", "entraÃ®nement", "rÃ©sistÃ©", "contenir", "avant", "enseigner", "semaine", "finale", "donnÃ©", "vert", "oh", "rapide", "dÃ©velopper", "ocÃ©an", "chaud", "gratuit", "minute", "fort", "spÃ©cial", "esprit", "derriÃ¨re", "clair", "queue", "produire", "fait", "espace", "entendu", "meilleur", "heure", "mieux", "vrai", "pendant", "cent", "cinq", "rappeler", "Ã©tape", "tÃ´t", "tenir", "ouest", "sol", "intÃ©rÃªt", "atteindre", "rapide", "verbe", "chanter", "Ã©couter", "six", "table", "voyage", "moins", "matin", "dix", "simple", "plusieurs", "voyelle", "vers", "guerre", "poser", "contre", "modÃ¨le", "lent", "centre", "amour", "personne", "argent", "servir", "apparaÃ®tre", "route", "carte", "pluie", "rÃ¨gle", "gouverner", "tirer", "froid", "avis", "voix", "Ã©nergie", "chasse", "probable", "lit", "frÃ¨re", "tour", "cellule", "croire", "peut-Ãªtre", "choisir", "soudain", "compter", "carrÃ©", "raison", "longueur", "reprÃ©senter", "art", "sujet", "rÃ©gion", "taille", "varier", "rÃ©gler", "parler", "poids", "gÃ©nÃ©ral", "glace", "question", "cercle", "paire", "inclure", "fracture", "syllabe", "feutre", "grandiose", "balle", "encore", "vague", "tomber", "prÃ©sent", "lourd", "danse", "moteur", "position", "bras", "large", "voile", "matÃ©riel", "fraction", "forÃªt", "course", "fenÃªtre", "magasin", "Ã©tÃ©", "train", "sommeil", "prouver", "seul", "jambe", "exercice", "mur", "capture", "monture", "souhaiter", "ciel", "conseil", "joie", "hiver", "sat", "Ã©crit", "sauvage", "instrument", "conservÃ©", "verre", "herbe", "vache", "emploi", "bord", "signe", "visite", "passÃ©", "doux", "amusement", "clair", "gaz", "temps", "mois", "million", "porter", "finition", "heureux", "espoir", "fleur", "vÃªtir", "Ã©trange", "disparu", "commerce", "mÃ©lodie", "bureau", "recevoir", "rangÃ©e", "bouche", "exact", "symbole", "mourir", "moins", "difficultÃ©", "cri", "sauf", "Ã©crit", "semence", "ton", "joindre", "suggÃ©rer", "propre", "pause", "dame", "cour", "augmenter", "mauvais", "coup", "huile", "sang", "toucher", "cent", "mÃ©langer", "Ã©quipe", "fil", "coÃ»t", "perdu", "brun", "porter", "jardin", "Ã©gal", "expÃ©diÃ©", "choisir", "dÃ©bit", "juste", "banque", "recueillir", "sauver", "contrÃ´le", "dÃ©cimal", "oreille", "autre", "cassÃ©", "cas", "milieu", "tuer", "fils", "lac", "moment", "Ã©chelle", "fort", "printemps", "observer", "enfant", "droit", "consonne", "nation", "dictionnaire", "lait", "vitesse", "mÃ©thode", "organe", "payer", "Ã¢ge", "section", "robe", "nuage", "surprise", "calme", "pierre", "minuscule", "montÃ©e", "frais", "conception", "pauvres", "lot", "expÃ©rience", "bas", "clÃ©", "fer", "unique", "bÃ¢ton", "plat", "vingt", "peau", "sourire", "pli", "trou", "sauter", "bÃ©bÃ©", "huit", "village", "racine", "acheter", "augmenter", "rÃ©soudre", "mÃ©tal", "si", "pousser", "sept", "paragraphe", "troisiÃ¨me", "doit", "cheveux", "dÃ©crire", "cuisinier", "Ã©tage", "chaque", "rÃ©sultat", "brÃ»ler", "colline", "coffre-fort", "chat", "siÃ¨cle", "envisager", "type", "droit", "peu", "cÃ´te", "copie", "phrase", "silencieux", "haut", "sable", "sol", "rouleau", "tempÃ©rature", "doigt", "industrie", "valeur", "lutte", "mensonge", "battre", "exciter", "naturel", "vue", "sens", "capital", "chaise", "danger", "fruit", "riche", "Ã©pais", "soldat", "processus", "fonctionner", "pratique", "sÃ©parÃ©", "difficile", "mÃ©decin", "protÃ©ger", "midi", "rÃ©colte", "moderne", "Ã©lÃ©ment", "frapper", "Ã©tudiant", "coin", "partie", "alimentation", "dont", "localiser", "anneau", "caractÃ¨re", "insecte", "pris", "pÃ©riode", "indiquer", "radio", "rayon", "atome", "humain", "histoire", "effet", "Ã©lectrique", "attendre", "os", "rail", "imaginer", "fournir", "ainsi", "doux", "femme", "capitaine", "deviner", "nÃ©cessaire", "net", "aile", "crÃ©er", "voisin", "lavage", "chauve-souris", "plutÃ´t", "foule", "blÃ©", "comparer", "poÃ¨me", "chaÃ®ne", "cloche", "dÃ©pendre", "viande", "rub", "tube", "cÃ©lÃ¨bre", "dollar", "courant", "peur", "vue", "mince", "triangle", "planÃ¨te", "chef", "colonie", "horloge", "mine", "lien", "entrer", "majeur", "frais", "recherche", "envoyer", "jaune", "pistolet", "permettre", "impression", "mort", "place", "dÃ©sert", "costume", "courant", "ascenseur", "rose", "arriver", "maÃ®tre", "piste", "mÃ¨re", "rivage", "division", "feuille", "substance", "favoriser", "relier", "poste", "passer", "corde", "graisse", "heureux", "original", "part", "station", "papa", "pain", "charger", "propre", "bar", "proposition", "segment", "esclave", "canard", "instant", "marchÃ©", "degrÃ©", "peupler", "poussin", "cher", "ennemi", "rÃ©pondre", "boisson", "support", "discours", "nature", "gamme", "vapeur", "mouvement", "chemin", "liquide", "enregistrer", "signifiait", "quotient", "dents", "coquille", "cou", "oxygÃ¨ne", "sucre", "dÃ©cÃ¨s", "assez", "compÃ©tence", "femmes", "saison", "solution", "aimant", "argent", "merci", "branche", "rencontre", "suffixe", "particuliÃ¨rement", "figue", "peur", "Ã©norme", "acier", "discuter", "avant", "similaire", "guider", "expÃ©rience", "score", "pomme", "achetÃ©", "pas", "manteau", "masse", "carte", "bande", "corde", "glissement", "gagner", "rÃªver", "soirÃ©e", "condition", "alimentation", "outil", "total", "odeur", "vallÃ©e", "ni", "double", "siÃ¨ge", "continuer", "bloc", "graphique", "chapeau", "vendre", "succÃ¨s", "entreprise", "soustraire", "Ã©vÃ©nement", "particulier", "accord", "baignade", "terme", "opposÃ©", "femme", "chaussure", "Ã©paule", "propagation", "organiser", "camp", "inventer", "coton", "nÃ©", "dÃ©terminer", "litre", "neuf", "camion", "bruit", "niveau", "chance", "recueillir", "boutique", "tronÃ§on", "jeter", "Ã©clat", "propriÃ©tÃ©", "colonne", "molÃ©cule", "sÃ©lectionner", "mal", "gris", "rÃ©pÃ©tition", "exiger", "large", "prÃ©parer", "sel", "nez", "pluriel", "colÃ¨re", "revendication", "continent"]
let index = 0;
const WORD_MAX = 16, WORD_MIN = 1;
const DEFAULT_WORD_MAX_LENGTH = 8;
let maxLength = DEFAULT_WORD_MAX_LENGTH; // DEFAULT VALUE
const DEFAULT_WORD_MIN_LENGTH = 3;
let minLength = DEFAULT_WORD_MIN_LENGTH; // DEFAULT VALUE
let selectedWords = [];
let score = 0;
let aps = 0;
let accents = false;
let solutions = new Map();

window.addEventListener('load', function () {
    // DEFAULT WORD LENGTH
    resetLength()
    generateArray()
    validateWord()
    displayRandomWords()
    setFirstWordStyle()
    resetBackground()
    timer()
});

function resetAll() {
    selectedWords = []
    generateArray()
    const elem = document.querySelectorAll('#displayWords span')
    elem.forEach(e => e.remove());
    displayRandomWords()
    setFirstWordStyle()
}

function generateWithSettings() {
    getSettings()
    resetAll()
}

function getSettings() {
    maxLength = document.getElementById('inputMaxLength').value;
    minLength = document.getElementById('inputMinLength').value;
}

function updateMin() {
    minLength = document.getElementById('inputMinLength').value;
    document.getElementById('inputMaxLength').setAttribute("min", minLength)
}

function updateMax() {
    maxLength = document.getElementById('inputMaxLength').value;
    document.getElementById('inputMinLength').setAttribute("max", maxLength)
}

function generateArray() {
    for (let i = 0; i < 300; i++) {
        let wordToAdd = words[Math.floor(Math.random() * words.length)];
        if (wordToAdd.length <= maxLength && wordToAdd.length >= minLength) {
            selectedWords[i] = wordToAdd;
        } else {
            i--;
        }
    }
}

function displayRandomWords() {
    for (let i = 0; i < 300; i++) {
        let div = document.getElementById('displayWords')
        let newDiv = document.createElement("span");
        newDiv.innerHTML = selectedWords[i]
        let currentDiv = document.getElementById('displayWords');
        document.body.insertBefore(newDiv, currentDiv);
        div.appendChild(newDiv)
    }
}
function validateWord() {
    document.getElementById('wordInput').onkeydown = function (event) {
        document.getElementById('generateWithSettings').disabled = true;
        document.getElementById('generateWithSettings').style.background = "grey";
        if ((event.keyCode === 32 || event.keyCode === 13) && document.getElementById('wordInput').value.trim() !== "") {
            document.getElementById('wordInput').innerHTML = document.getElementById('wordInput').value.trim()
            aps += document.getElementById('wordInput').value.length + 1;
            trackWord(index)
            updateScore()
            getWordInput()
            index++;
            console.log(accents)
            return false;
        }
    }
}
function clearInput() {
    document.getElementById('wordInput').value = ""
}

function getWordInput() {
    clearInput()
}

function trackWord(index) {
    let spans = document.getElementById('displayWords').getElementsByTagName('span');
    let currentWord = spans.item(index);
    let previous = spans.item(index + 1);
    let width = currentWord.clientWidth;
    previous.style.color = "#5efaff";
    previous.style.fontWeight = "bolder";
    document.getElementById('displayWords').scrollLeft += width + 40;
}

function updateScore() {
    document.querySelector("#score").innerHtml = "Score : " + score;
    if (document.getElementById('wordInput').textContent.toLowerCase() === selectedWords[index]) {
        document.getElementById('wordInput').style.background = "#2f4e21"
        score++;
        document.querySelector("#score").innerHTML = "Score : " + score;
    } else {
        solutions.set(selectedWords[index], document.getElementById('wordInput').value)
        document.getElementById('wordInput').style.background = "#571b1b"
    }
    resetBackground()

}

function resetBackground() {
    setTimeout(() => {
        document.getElementById('wordInput').style.background = "black"
    }, 200)
}

function timer() {
    let textarea = document.getElementById("wordInput");
    let timer;
    let time = 0;
    let seconds = 1000 * 60; //1000 = 1 second in JS
    textarea.addEventListener('keyup', starting)

    function starting() {
        textarea.removeEventListener("keyup", starting);
        if (seconds === 60000)
            timer = setInterval(starting, 1000)
        if (time !== 0) { // avoid NaN
            document.getElementById("aps").innerHTML = Math.round(aps * 100 / time) / 100 + " aps";
        }
        time++;
        seconds -= 1000;
        if (seconds / 1000 < 10) {
            document.getElementById("timer").innerHTML = '0:0' + seconds / 1000;
        } else {
            document.getElementById("timer").innerHTML = '0:' + seconds / 1000;
        }

        if (seconds <= 0) {
            clearInterval(timer);
            showScores()
        }
    }
    document.getElementById("timer").innerHTML = "1:00";
}

function showScores() {
    document.getElementById("timer").innerHTML = "";
    document.getElementById("wordInput").remove()
    document.getElementById("score").innerHTML = score + " mots corrects pour " + index + " mots tentÃ©s ðŸ‘";
    document.getElementById("apm").innerHTML = aps + " actions par minute ðŸ‘½";
    document.getElementById("aps").innerHTML = Math.round(aps * 100 / 60) / 100 + " actions par seconde âœ¨";
    document.getElementById("score").style.marginTop = "8px"
    document.getElementById('wrongWords').innerHTML = "Erreurs :<br>"
    showWordsErrors()
}

function showWordsErrors() {
    for (let [key, value] of solutions.entries()) {
        document.getElementById('wrongWords').innerHTML += "<span class='mistakeWord'>" + value + "</span>" + " âž¡ <span class='correctWord'>" + key + "</span><br>"
    }
}

function setFirstWordStyle() {
    document.getElementById('displayWords').getElementsByTagName('span').item(index).style.color = "#5efaff";
    document.getElementById('displayWords').getElementsByTagName('span').item(index).style.fontWeight = "bolder";
}

function resetLength() {
    document.getElementById('inputMaxLength').value = DEFAULT_WORD_MAX_LENGTH;
    maxLength = DEFAULT_WORD_MAX_LENGTH;
    document.getElementById('inputMinLength').value = DEFAULT_WORD_MIN_LENGTH;
    minLength = DEFAULT_WORD_MIN_LENGTH;

    document.getElementById('inputMaxLength').setAttribute("min", minLength)
    document.getElementById('inputMaxLength').setAttribute("max", WORD_MAX)
    document.getElementById('inputMinLength').setAttribute("max", maxLength)
    document.getElementById('inputMinLength').setAttribute("min", WORD_MIN)

    // ADD TO HTML
    this.document.getElementById('outputMaxLength').innerHTML = DEFAULT_WORD_MAX_LENGTH
    this.document.getElementById('outputMinLength').innerHTML = DEFAULT_WORD_MIN_LENGTH
}

// CHECK RESET
document.getElementById('reset').onclick = function () {
    location.reload();
}